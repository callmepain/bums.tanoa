#include "..\..\script_macros.hpp"
/*
    File: fn_hudCrew.sqf
    Author: H4uklotz / CallmePain
	
    Description:
	Zeigt die Fahrzeuginsassen an, setzt den Spritverbrauch und zeigt diesen an.
*/
   
   
Private ["_name","_vehicle","_vehname","_weapname","_weap","_target","_picture","_vehtarget","_azimuth","_wepdir","_hudnames","_ui"];   
	   
disableSerialization;


[] spawn 
{
	for "_i" from 0 to 1 step 0 do 
	{
		if (isEngineOn vehicle player  && ((driver vehicle player ) == player) && ((typeOf vehicle player) in life_FahrenPKW) && (vehicle player  != player) && (speed vehicle player > 10)) then
		{
			_exp = M_CONFIG(getNumber,"profession","FahrenPKW","baseEXPgain");
//			if (floor (random 20) == 3) then {
				["FahrenPKW",_exp] call life_fnc_addExp;
//			};
		};  
		sleep M_CONFIG(getNumber,"profession","FahrenPKW","time");
	//	sleep 1;
	};  
};  
[] spawn 
{
	for "_i" from 0 to 1 step 0 do 
	{
		if (isEngineOn vehicle player  && ((driver vehicle player ) == player) && ((typeOf vehicle player) in life_FahrenLKW) && (vehicle player  != player) && (speed vehicle player > 10)) then
		{
			_exp = M_CONFIG(getNumber,"profession","FahrenLKW","baseEXPgain");
			["FahrenLKW",_exp] call life_fnc_addExp;
		};  
		sleep M_CONFIG(getNumber,"profession","FahrenLKW","time");
	};  
};  
[] spawn 
{
	for "_i" from 0 to 1 step 0 do 
	{
		if (isEngineOn vehicle player  && ((driver vehicle player ) == player) && ((typeOf vehicle player) in life_Fahrenair) && (vehicle player  != player) && (speed vehicle player > 10)) then
		{
			_exp = M_CONFIG(getNumber,"profession","Fliegen","baseEXPgain");
			["Fliegen",_exp] call life_fnc_addExp;
		};  
		sleep M_CONFIG(getNumber,"profession","Fliegen","time");
	};  
};  

while {true} do  {

   	 1000 cutRsc ["HudNames","PLAIN"];
   	 _ui = uiNameSpace getVariable "HudNames";
 	 _HudNames = _ui displayCtrl 99999;

    
	if(vehicle player != player) then
	{
		_name = "";
		_vehicle = assignedVehicle player;
		_vehname= getText (configFile >> "CfgVehicles" >> (typeOf vehicle player) >> "DisplayName");
		_name = format ["<t color='#00ff00'>Fahrzeug: %1</t><br/>", _vehname];
		_exp = 0;
		_crewlist = "";
	
		{
			_crewlist = _crewlist + name _x + ",";
		}
		foreach crew cursorTarget;
					
		{
			if((driver _vehicle == _x) || (gunner _vehicle == _x)) then
			{
					
				if(driver _vehicle == _x) then
				{
					_vehicleInfo = [typeOf _vehicle] call life_fnc_fetchVehInfo; 
					_vehicleTankMax = _vehicleInfo select 12;					
					_fuel_old = fuel _vehicle;									
					_vehicleToFuel = (vehicle player);
					_veh = (typeOf _vehicleToFuel);
					
					switch(true) do
					{
						case (isEngineOn _vehicleToFuel && ((driver _vehicleToFuel) == player) && (_vehicleToFuel isKindOf "Landvehicle") && (_vehicleToFuel != player) && (_veh in life_truck)):
						{
							_fuelConsumption = 0;
							_mass = getMass _vehicleToFuel;
							_vehiclespeed = speed _vehicleToFuel;
							_fuel_old = fuel _vehicle;
							_exp = (_mass / 10000) + exp(_vehiclespeed/45)+(0.5*(cos((_vehiclespeed*(180/3.141))/3)));
							if (_vehiclespeed < 10) then {
								_fuelConsumption = ((_exp * 0.6) / 10000);
							}else {
								_fuelConsumption = ((_exp * 1.15) / 10000);
							};
							_vehicleToFuel setFuel (_fuel_old - _fuelConsumption);
							_fuelConsumption = round(_fuelConsumption * 1000000)/100;
							_name = format ["%1<t size='0.85' color='#ffff00'>Dieselverbrauch: <t/><t color='#ff0000'>%3 Liter</t><br/><t size='1' color='#00ff00'>Insassen:</t><br/><img size='0.7' color='#ff0000' image='a3\ui_f\data\IGUI\Cfg\Actions\getindriver_ca.paa'/><t size='0.85' color='#ffff00'>   %2</t><br/>", _name, (name _x), (_fuelConsumption)]; 
						};
						case (isEngineOn _vehicleToFuel && ((driver _vehicleToFuel) == player) && (_vehicleToFuel isKindOf "Landvehicle") && (_vehicleToFuel != player) && (_veh in life_hmmt)):
						{
							_fuelConsumption = 0;
							_mass = getMass _vehicleToFuel;
							_vehiclespeed = speed _vehicleToFuel;
							_fuel_old = fuel _vehicle;
							_exp = (_mass / 10000) + exp(_vehiclespeed/45)+(0.5*(cos((_vehiclespeed*(180/3.141))/3)));
							if (_vehiclespeed < 10) then {
								_fuelConsumption = ((_exp * 0.6) / 10000);
							}else {
								_fuelConsumption = ((_exp * 1.15) / 10000);
							};
							_vehicleToFuel setFuel (_fuel_old - _fuelConsumption);
							_fuelConsumption = round(_fuelConsumption * 1000000)/100;
							_name = format ["%1<t size='0.85' color='#ffff00'>Dieselverbrauch: <t/><t color='#ff0000'>%3 Liter</t><br/><t size='1' color='#00ff00'>Insassen:</t><br/><img size='0.7' color='#ff0000' image='a3\ui_f\data\IGUI\Cfg\Actions\getindriver_ca.paa'/><t size='0.85' color='#ffff00'>   %2</t><br/>", _name, (name _x), (_fuelConsumption)]; 
						};
						case (isEngineOn _vehicleToFuel && ((driver _vehicleToFuel) == player) && (_vehicleToFuel isKindOf "Landvehicle") && (_vehicleToFuel != player)):
						{
							_fuelConsumption = 0;
							_mass = getMass _vehicleToFuel;
							_vehiclespeed = speed _vehicleToFuel;
							_fuel_old = fuel _vehicle;
							_exp = (_mass / 3000) + (exp(_vehiclespeed/180))+(0.5*(cos((_vehiclespeed*(180/3.141))/8)));
							if (_vehiclespeed < 10) then {
								_fuelConsumption = ((_exp * 0.6) / 10000);
							}else {
								_fuelConsumption = ((_exp * 3.5) / 10000);
							};
							_vehicleToFuel setFuel (_fuel_old - _fuelConsumption);
							_fuelConsumption = round(_fuelConsumption * 1000000)/100;

							_name = format ["%1<t size='0.85' color='#ffff00'>Benzinverbrauch: <t/><t color='#ff0000'>%3 Liter</t><br/><t size='1' color='#00ff00'>Insassen:</t><br/><img size='0.7' color='#ff0000' image='a3\ui_f\data\IGUI\Cfg\Actions\getindriver_ca.paa'/><t size='0.85' color='#ffff00'>   %2</t><br/>", _name, (name _x), (_fuelConsumption)]; 
						};
						case (isEngineOn _vehicleToFuel && ((driver _vehicleToFuel) == player) && (_vehicleToFuel isKindOf "Air") && (_vehicleToFuel != player)):
						{
							_fuelConsumption = 0;
							_mass = getMass _vehicleToFuel;
							_vehiclespeed = speed _vehicleToFuel;
							_fuel_old = fuel _vehicle;
							_exp = (_mass / 3000) + (exp(_vehiclespeed/180))+(0.5*(cos((_vehiclespeed*(180/3.141))/8)));
							if (_vehiclespeed < 10) then {
								_fuelConsumption = ((_exp * 0.6) / 10000);
							}else {
								_fuelConsumption = ((_exp * 2) / 10000);
							};
							_vehicleToFuel setFuel (_fuel_old - _fuelConsumption);
							_fuelConsumption = round(_fuelConsumption * 1000000)/100;
							_name = format ["%1<t size='0.85' color='#ffff00'>Kerosinverbrauch: <t/><t color='#ff0000'>%3 Liter</t><br/><t size='1' color='#00ff00'>Insassen:</t><br/><img size='0.7' color='#ff0000' image='a3\ui_f\data\IGUI\Cfg\Actions\getindriver_ca.paa'/><t size='0.85' color='#ffff00'>   %2</t><br/>", _name, (name _x), (_fuelConsumption)]; 
						};
						
						default
						{
							_name = format ["%1<img size='0.7' color='#ff0000' image='a3\ui_f\data\IGUI\Cfg\Actions\getindriver_ca.paa'/><t size='0.85' color='#ffff00'>   %2</t><br/>", _name, (name _x)];
						};
					};
				}
				else
				{
					_target = cursorTarget;
					_picture = getText (configFile >> "cfgVehicles" >> typeOf _target >> "displayname");
					_vehtarget =  format ["%1",_picture];
					_name = format ["%1<img size='0.7' color='#ff0000' image='a3\ui_f\data\IGUI\Cfg\Actions\getindriver_ca.paa'/><t size='0.85' color='#ffff00'>   %2</t><br/><t size='0.85' color='#ffff00'> Ziel: </t><t size='0.85' color='#ff0000'>%3 %4</t><br/>", _name, (name _x), _vehtarget,_crewlist];
					
				};
			   
			}
			else
			{
				_name = format ["%1<img size='0.7' color='#ff0000' image='a3\ui_f\data\IGUI\Cfg\Actions\getindriver_ca.paa'/><t size='0.85' color='#ffff00'>   %2</t><br/>", _name, (name _x)];
			};  
			
			
			  
		} forEach crew _vehicle;

		_HudNames ctrlSetStructuredText parseText _name;
		_HudNames ctrlCommit 0;  
		sleep 1;
	};  
};
  